# Rate Limiting Zones
limit_req_zone $binary_remote_addr zone=general:10m rate=10r/s;

limit_req_zone $binary_remote_addr zone=api:10m rate=30r/s;

limit_req_zone $binary_remote_addr zone=auth:10m rate=5r/m;

limit_req_zone $binary_remote_addr zone=static:10m rate=100r/s;

# Connection limits per IP and server
limit_conn_zone $binary_remote_addr zone=addr:10m;
limit_conn_zone $server_name zone=perserver:10m;

# Request limits by user agent
map $http_user_agent $limit_bots {
    default 0;
    ~*(bot|crawler|spider|scraper) 1;
}
limit_req_zone $limit_bots zone=bots:10m rate=2r/s;

# Define request limit status
limit_req_status 429;
limit_conn_status 429;