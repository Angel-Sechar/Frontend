# Request Filtering and Validation

# Maximum request header size check
map $http_cookie $blocked_cookie {
    default 0;
    "~^.{1024,}$" 1;
}

# SQL Injection patterns
map $args $blocked_sql {
    default 0;
    ~*(union|select|insert|drop|update|delete|exec|script) 1;
    ~*(benchmark|sleep|waitfor) 1;
}

# XSS patterns
map $args $blocked_xss {
    default 0;
    ~*(<script|javascript:|onerror=|onload=) 1;
    ~*(document\.|window\.|alert\(|eval\() 1;
}

# Path traversal patterns
map $uri $blocked_traversal {
    default 0;
    ~*(\.\./|\.\.\\|%2e%2e) 1;
}

# Combined blocking rule
set $block_request 0;
if ($blocked_uri) { set $block_request 1; }
if ($blocked_agent) { set $block_request 1; }
if ($blocked_method) { set $block_request 1; }
if ($blocked_referer) { set $block_request 1; }
if ($blocked_cookie) { set $block_request 1; }
if ($blocked_sql) { set $block_request 1; }
if ($blocked_xss) { set $block_request 1; }
if ($blocked_traversal) { set $block_request 1; }