@let localControl = control();
@let localLabel = label();
@let uniqueId = inputId();
@let localType = type();
@let localRequired = isRequired();
@let localPlaceholder = placeholder();
@let showErrors = localControl.invalid && (localControl.dirty || localControl.touched);
<label [for]="uniqueId" [class]="localLabel ? 'block text-sm font-medium text-gray-700 mb-2' : 'sr-only'">
  {{ localLabel || localPlaceholder }}
  @if (localRequired && localLabel) {
    <span aria-hidden="true" class="text-red-500 ml-1">*</span>
    <span class="sr-only">(required)</span>
  }
</label>
<input
  [id]="uniqueId"
  [formControl]="localControl"
  (blur)="onTouched()"
  [type]="localType"
  [required]="localRequired"
  [placeholder]="localPlaceholder"
  [attr.aria-required]="localRequired"
  [attr.aria-invalid]="showErrors ? 'true' : 'false'"
  [attr.aria-describedby]="showErrors ? uniqueId + '-errors' : null"
  class="input-base input-default"
  [class.input-error]="showErrors"
  (keypress)="blockInvalidChars($event)"
/>

@if (showErrors) {
  <div [id]="uniqueId + '-errors'" role="alert" aria-live="polite">
    @if (localControl.errors?.["required"]) {
      <mat-error>This field is required.</mat-error>
    }
    @if (localControl.errors?.["minlength"]) {
      <mat-error>
        Minimum length is {{ localControl.errors?.["minlength"].requiredLength }} characters.
      </mat-error>
    }
    @if (localControl.errors?.["maxlength"]) {
      <mat-error>
        Maximum length is {{ localControl.errors?.["maxlength"].requiredLength }} characters.
      </mat-error>
    }
    @if (localControl.errors?.["email"]) {
      <mat-error>Please enter a valid email address.</mat-error>
    }
    @if (localControl.errors?.["pattern"]) {
      <mat-error>Invalid format.</mat-error>
    }
    @if (localControl.errors?.["invalidCharacter"]) {
      <mat-error>
        Only letters, numbers, and the following special characters are allowed: {{ specialCharacters }}
      </mat-error>
    } @else {
      @if (localControl.errors?.["missingLowercase"]) {
        <mat-error>At least one lowercase letter required.</mat-error>
      }
      @if (localControl.errors?.["missingUppercase"]) {
        <mat-error>At least one uppercase letter required.</mat-error>
      }
      @if (localControl.errors?.["missingNumber"]) {
        <mat-error>At least one number required.</mat-error>
      }
      @if (localControl.errors?.["missingSpecial"]) {
        <mat-error>At least one special character required ({{ specialCharacters }}).</mat-error>
      }
    }
  </div>
}
