@let localControl = control();
@let localLabel = label();
@let uniqueId = inputId();
@let localType = type();
@let localRequired = isRequired();
@let localPlaceholder = placeholder();
@let showErrors = localControl.invalid && (localControl.dirty || localControl.touched);
<label [for]="uniqueId" [class]="localLabel ? 'block text-sm font-medium text-gray-700 mb-2' : 'sr-only'">
  {{ localLabel || localPlaceholder }}
  @if (localRequired && localLabel) {
    <span aria-hidden="true" class="text-red-500 ml-1">*</span>
    <span class="sr-only">(required)</span>
  }
</label>
<input
  [id]="uniqueId"
  [formControl]="localControl"
  (blur)="onTouched()"
  [type]="localType"
  [required]="localRequired"
  [placeholder]="localPlaceholder"
  [attr.aria-required]="localRequired"
  [attr.aria-invalid]="showErrors ? 'true' : 'false'"
  [attr.aria-describedby]="showErrors ? uniqueId + '-errors' : null"
  class="input-base input-default"
  [class.input-error]="showErrors"
  (keypress)="blockInvalidChars($event)"
/>

@if (showErrors) {
  <div [id]="uniqueId + '-errors'" role="alert" aria-live="polite">
    @if (localControl.errors?.["required"]) {
      <mat-error>Este campo es requerido.</mat-error>
    }
    @if (localControl.errors?.["minlength"]) {
      <mat-error>
        Mínima longitud es de {{ localControl.errors?.["minlength"].requiredLength }} caracteres.
      </mat-error>
    }
    @if (localControl.errors?.["maxlength"]) {
      <mat-error>
        Máxima longitud es de {{ localControl.errors?.["maxlength"].requiredLength }} caracteres.
      </mat-error>
    }
    @if (localControl.errors?.["email"]) {
      <mat-error>Por favor ingrese un correo electrónico válido.</mat-error>
    }
    @if (localControl.errors?.["pattern"]) {
      <mat-error>Formato inválido.</mat-error>
    }
    @if (localControl.errors?.["invalidCharacter"]) {
      <mat-error>
        Sólo letras, números y los siguientes caracteres especiales están permitidos: {{ specialCharacters }}
      </mat-error>
    } @else {
      @if (localControl.errors?.["missingLowercase"]) {
        <mat-error>Al menos una letra minúscula es requerida.</mat-error>
      }
      @if (localControl.errors?.["missingUppercase"]) {
        <mat-error>Al menos una letra mayúscula es requerida.</mat-error>
      }
      @if (localControl.errors?.["missingNumber"]) {
        <mat-error>Al menos un número es requerido.</mat-error>
      }
      @if (localControl.errors?.["missingSpecial"]) {
        <mat-error>Al menos un carácter especial es requerido ({{ specialCharacters }}).</mat-error>
      }
    }
  </div>
}
