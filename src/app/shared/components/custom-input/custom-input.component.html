@let localControl = control();
@let localLabel = label();
@let uniqueId = inputId();
@let localType = type();
@let localRequired = isRequired();
@let localPlaceholder = placeholder();
@let showErrors = localControl.invalid && (localControl.dirty || localControl.touched);
@let noPasteLocal = noPaste();
<mat-form-field class="w-full">
  <mat-label [class]="localLabel ? 'w-full' : 'sr-only'">
    {{ localLabel || localPlaceholder }}
    @if (localRequired && localLabel) {
      <span class="sr-only">(required)</span>
    }
  </mat-label>
  @if (localType === "date") {
    <div class="flex items-center w-full max-h-4">
      <input
        matInput
        [matDatepicker]="picker"
        [formControl]="localControl"
        [placeholder]="localPlaceholder"
        (keypress)="blockInvalidCharsForm($event, regexValidator())"
        [noPaste]="noPasteLocal"
        (pasteAttempted)="onPasteAttempted()"
        [max]="maxDate()"
        [min]="minDate()"
        dateAutoformat
        maxlength="10"
      />
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </div>
  } @else {
    <input
      matInput
      [id]="uniqueId"
      [formControl]="localControl"
      (blur)="onTouched()"
      [type]="localType"
      [required]="localRequired"
      [placeholder]="localPlaceholder"
      [attr.aria-required]="localRequired"
      [attr.aria-invalid]="showErrors ? 'true' : 'false'"
      [attr.aria-describedby]="showErrors ? uniqueId + '-errors' : null"
      (keypress)="blockInvalidCharsForm($event, regexValidator())"
      [noPaste]="noPasteLocal"
      (pasteAttempted)="onPasteAttempted()"
    />
  }
  @if (showErrors) {
    <div [id]="uniqueId + '-errors'" role="alert" aria-live="polite" class="mt-1 space-y-1">
      @if (localControl.errors?.["required"]) {
        <mat-error>Este campo es requerido</mat-error>
      } @else if (localControl.errors?.["minlength"]) {
        <mat-error>
          Mínima longitud es de {{ localControl.errors?.[&quot;minlength&quot;].requiredLength }} caracteres.
        </mat-error>
      } @else if (localControl.errors?.["maxlength"]) {
        <mat-error>
          Máxima longitud es de {{ localControl.errors?.["maxlength"].requiredLength }} caracteres.
        </mat-error>
      } @else if (localControl.errors?.["email"]) {
        <mat-error>Por favor ingrese un correo electrónico válido.</mat-error>
      } @else if (localControl.errors?.["pattern"]) {
        <mat-error>Formato inválido.</mat-error>
      } @else if (localControl.errors?.["invalidCharacter"]) {
        <mat-error>
          Sólo se permiten letras, números y los siguientes caracteres especiales:
          {{ specialCharacters }}
        </mat-error>
      } @else {
        @if (localControl.errors?.["missingLowercase"]) {
          <mat-error>Requiere una letra minúscula.</mat-error>
        } @else if (localControl.errors?.["missingUppercase"]) {
          <mat-error>Requiere una letra mayúscula.</mat-error>
        } @else if (localControl.errors?.["missingNumber"]) {
          <mat-error>Requiere un número.</mat-error>
        } @else if (localControl.errors?.["missingSpecial"]) {
          <mat-error>Requiere un carácter especial {{ specialCharacters }}</mat-error>
        }
      }
    </div>
  }
</mat-form-field>
